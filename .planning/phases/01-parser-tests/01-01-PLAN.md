---
phase: 01-parser-tests
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: ["src/input/parser.rs"]
autonomous: true
must_haves:
  truths:
    - "Parser accepts OT1 0 (heater off) without error"
    - "Parser accepts OT1 100 (heater max) without error"
    - "Parser accepts IO3 0 (fan off) without error"
    - "Parser accepts IO3 100 (fan max) without error"
    - "Parser rejects IO3 values greater than 100 with InvalidValue error"
  artifacts:
    - path: "src/input/parser.rs"
      provides: "Parser tests module with boundary values"
      min_lines: 106
    - path: "src/input/parser.rs"
      provides: "5 new test functions for boundary conditions"
      exports: ["test_parse_ot1_zero", "test_parse_ot1_max", "test_parse_io3_zero", "test_parse_io3_max", "test_parse_io3_invalid_above"]
  key_links:
    - from: "src/input/parser.rs"
      to: "parser tests"
      via: "inline #[cfg(test)] mod tests"
      pattern: "#\\[cfg\\(test)\\]"
---

<objective>
Add 5 boundary value tests to parser module to verify OT1 and IO3 command handling at edge values (0, 100) and rejection of invalid values (>100).

Purpose: Ensure parser correctly handles all boundary conditions for heater and fan control commands, completing TEST-01 through TEST-06 requirements.

Output: Updated parser.rs with 5 new test functions, verified by 13 passing tests.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/juan/Repos/LibreRoaster/.planning/phases/01-parser-tests/01-RESEARCH.md

# Existing Test Coverage
src/input/parser.rs has 8 tests:
- test_parse_read_command, test_parse_start_command, test_parse_ot1_command (75), test_parse_io3_command (50)
- test_parse_stop_command, test_invalid_command, test_invalid_value (OT1 150), test_empty_command

# Tests to Add
Following RESEARCH.md recommendations, add:
1. test_parse_ot1_zero - OT1 0
2. test_parse_ot1_max - OT1 100
3. test_parse_io3_zero - IO3 0
4. test_parse_io3_max - IO3 100
5. test_parse_io3_invalid_above - IO3 150
</context>

<tasks>

<task type="auto">
  <name>Add 5 boundary value tests to parser.rs</name>
  <files>src/input/parser.rs</files>
  <action>
    Add 5 new test functions to the existing #[cfg(test)] mod tests section in src/input/parser.rs, following the naming convention and patterns from RESEARCH.md.

    Insert tests before the closing brace of the tests module (line 105), after test_empty_command.

    Required tests:
    1. test_parse_ot1_zero - assert parse_artisan_command("OT1 0") returns Ok(ArtisanCommand::SetHeater(0))
    2. test_parse_ot1_max - assert parse_artisan_command("OT1 100") returns Ok(ArtisanCommand::SetHeater(100))
    3. test_parse_io3_zero - assert parse_artisan_command("IO3 0") returns Ok(ArtisanCommand::SetFan(0))
    4. test_parse_io3_max - assert parse_artisan_command("IO3 100") returns Ok(ArtisanCommand::SetFan(100))
    5. test_parse_io3_invalid_above - assert parse_artisan_command("IO3 150") returns Err(ParseError::InvalidValue)

    Follow the exact pattern of existing tests (e.g., test_parse_ot1_command at lines 70-74) using matches! macro.
  </action>
  <verify>cargo test --features test 2>&1 | grep -E "test_parse_ot1_zero|test_parse_ot1_max|test_parse_io3_zero|test_parse_io3_max|test_parse_io3_invalid_above|running|passed"</verify>
  <done>
    cargo test --features test shows 13 passing tests (8 existing + 5 new)
    All 6 requirements verified: OT1 0, OT1 100, IO3 0, IO3 100, OT1 > 100, IO3 > 100
  </done>
</task>

</tasks>

<verification>
Run: cargo test --features test

Expected output:
- 13 tests passed (8 existing + 5 new)
- 0 tests failed
- All test names visible including new boundary tests

If compilation fails: Check that test feature enables std correctly in Cargo.toml
</verification>

<success_criteria>
- [ ] 5 new tests added to src/input/parser.rs
- [ ] Tests follow existing naming convention (test_parse_<command>_<modifier>)
- [ ] cargo test --features test passes with 13 passing tests
- [ ] All 6 parser test requirements (TEST-01 through TEST-06) are verified by passing tests
</success_criteria>

<output>
After completion, create `.planning/phases/01-parser-tests/01-01-SUMMARY.md`
</output>

---
phase: "28-command-reference"
plan: "01"
type: "execute"
wave: 1
depends_on: []
files_modified:
  - "internalDoc/COMMAND_REFERENCE.md"
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can understand what each command does"
    - "User can correctly format commands for Artisan"
    - "User understands expected responses"
    - "User can troubleshoot errors"
    - "User understands the roast flow (START → control → STOP)"
  artifacts:
    - path: "internalDoc/COMMAND_REFERENCE.md"
      provides: "User-friendly command reference for roasters"
      min_lines: 200
  key_links:
    - from: "ARTISAN_CONNECTION.md"
      to: "COMMAND_REFERENCE.md"
      via: "Cross-reference for command usage"
      pattern: "command|control|READ|OT1|IO3"
    - from: "PROTOCOL.md"
      to: "COMMAND_REFERENCE.md"
      via: "Technical reference for advanced users"
      pattern: "See.*COMMAND_REFERENCE"
---

<objective>
Create a user-friendly Artisan protocol command reference for end users (roasters). Transform technical PROTOCOL.md into accessible documentation that explains what each command does, how to use it, and what to expect.

Purpose: Enable roasters to understand and use all LibreRoaster commands during roasting sessions.
Output: COMMAND_REFERENCE.md in internalDoc/
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Reference existing documentation
@internalDoc/PROTOCOL.md
@internalDoc/ARTISAN_CONNECTION.md
</context>

<tasks>

<task type="auto">
  <name>Analyze PROTOCOL.md command structure</name>
  <files>internalDoc/PROTOCOL.md</files>
  <action>
    Read PROTOCOL.md and extract:
    1. All commands with their formats and descriptions
    2. READ response format with all 7 fields
    3. Error response format and error codes
    4. Multiplexer behavior (first command wins, 60-second timeout)
    5. Any notes about command behavior
    
    Create analysis comment at top of COMMAND_REFERENCE.md documenting command structure.
  </action>
  <verify>Analysis exists at top of COMMAND_REFERENCE.md with command structure</verify>
  <done>Command structure analyzed and documented</done>
</task>

<task type="auto">
  <name>Create COMMAND_REFERENCE.md user-friendly guide</name>
  <files>internalDoc/COMMAND_REFERENCE.md</files>
  <action>
    Create a comprehensive COMMAND_REFERENCE.md with this structure:

    1. **Title**: "LibreRoaster Command Reference"
    
    2. **Introduction Section** (NEW):
       - What this guide covers (all commands, responses, errors)
       - How to use this guide during roasting
       - Key concept: Commands are text sent to the roaster
    
    3. **Quick Reference Table** (NEW - at top for fast lookup):
       | Command | Action | Example |
       |---------|--------|---------|
       | READ | Get temperatures | READ |
       | OT1 XX | Set heater | OT1 50 |
       | IO3 XX | Set fan | IO3 75 |
       | START | Begin roast | START |
       | STOP | Emergency stop | STOP |
    
    4. **Command Details Section** (DETAILED EXPLANATIONS for each):
       
       **READ — Get Current Readings:**
       - What it does: Requests all current temperature and output readings
       - When to use: Anytime you want to see current values
       - What you send: `READ\r`
       - What you get: `185.2,192.3,-1,-1,24.5,45,75`
       - How to read the response (break down each field clearly)
       - Visual example showing what Artisan displays
       
       **OT1 — Set Heater Power:**
       - What it does: Sets the heater output percentage
       - Range: 0 (off) to 100 (full)
       - When to use: During roasting to control heat
       - Example: `OT1 50` = 50% heater power
       - Tips: Start low, increase gradually
       
       **IO3 — Set Fan Speed:**
       - What it does: Sets the fan output percentage
       - Range: 0 (off) to 100 (full)
       - When to use: Control airflow during roasting
       - Example: `IO3 75` = 75% fan speed
       - Tips: Higher fan = more cooling, lower = more heat retention
       
       **UP/DOWN — Incremental Control:**
       - What it does: Increase/decrease heater by 5%
       - When to use: Fine-tuning during roast
       - Example: `UP` = heater +5%
       - Tips: Small adjustments, watch temperature response
       
       **START — Begin Roasting:**
       - What it does: Enables continuous output streaming
       - When to use: When you start the roast
       - What happens: Roaster starts sending readings automatically
       - Example: Send `START`, then watch Artisan scope
       
       **STOP — Emergency Stop:**
       - What it does: Immediately disables heater and fan
       - When to use: Emergency situations only
       - Warning: Immediately stops all heating
       - After STOP: Must send commands again to resume
    
    5. **Understanding Responses Section** (EXPANDED):
       - READ response breakdown (all 7 fields explained simply)
       - Example responses with annotations
       - What each temperature field means
       - What the fan/heater percentages show
    
    6. **Error Messages Section** (EXPANDED):
       - Common errors and what they mean
       - `ERR empty_command` — send something
       - `ERR unknown_command` — typo in command
       - `ERR invalid_value` — number out of range
       - How to recover from errors
       - Tips: Check your command format
    
    7. **Roast Flow Section** (NEW - tells the story):
       - Step 1: Connect to Artisan
       - Step 2: Send START
       - Step 3: Monitor temperatures with READ
       - Step 4: Adjust heater/fan with OT1, IO3, UP, DOWN
       - Step 5: Send STOP when done
       - Visual timeline or flow diagram
    
    8. **Tips and Best Practices** (NEW):
       - Watch temperature trends, not just values
       - Make small adjustments, wait for response
       - Use UP/DOWN for fine-tuning
       - Keep hands ready for STOP
       - Artisan scope shows the full picture
    
    Keep language simple. Add visual examples and annotations.
  </action>
  <verify>COMMAND_REFERENCE.md exists with all 8 sections and 200+ lines</verify>
  <done>Complete Command Reference Guide created</done>
</task>

</tasks>

<verification>
1. COMMAND_REFERENCE.md has all sections: Introduction, Quick Reference, Command Details, Understanding Responses, Error Messages, Roast Flow, Tips
2. All 7 commands covered: READ, OT1, IO3, UP, DOWN, START, STOP
3. READ response breakdown explains all 7 fields
4. Error messages section covers all 4 error types
5. Roast flow section tells the complete story
6. Language accessible to non-technical users
7. Examples are clear and annotated
</verification>

<success_criteria>
- COMMAND_REFERENCE.md contains 200+ lines with complete command reference
- Quick Reference table at top for fast lookup
- Each command has: what it does, when to use, example, tips
- READ response breakdown is clear and educational
- Error messages section is practical
- Roast flow section tells the complete story
- Cross-referenced from ARTISAN_CONNECTION.md
</success_criteria>

<output>
After completion, create `.planning/phases/28-command-reference/28-01-SUMMARY.md`
</output>

---
phase: 04-code-removal
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/control/command_handler.rs
  - src/control/pid.rs
  - src/control/abstractions_tests.rs
  - src/control/mod.rs
autonomous: true
user_setup: []
must_haves:
  truths:
    - "Unused control modules no longer exist in the codebase"
    - "Control module exports are cleaned up in mod.rs"
    - "Project still compiles after deletion"
  artifacts:
    - path: src/control/command_handler.rs
      provides: "Deleted - unused command handler"
    - path: src/control/pid.rs
      provides: "Deleted - unused PID controller"
    - path: src/control/abstractions_tests.rs
      provides: "Deleted - orphaned test file"
  key_links:
    - from: src/control/mod.rs
      to: "Deleted modules"
      via: "Removed pub use statements for deleted modules"
---

<objective>
Delete 3 unused control modules identified in codebase analysis:
- command_handler.rs (~50 lines) - RoasterCommandHandler trait, never used directly
- pid.rs (~100 lines) - CoffeeRoasterPid struct, referenced but never instantiated
- abstractions_tests.rs (180 lines) - Test mocks for code that may be deleted

Clean up module exports in control/mod.rs to reflect deletions.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/PROJECT.md
@.planning/phases/04-code-removal/04-CONTEXT.md

# Code analysis confirming these modules are unused

## command_handler.rs
- Defined: RoasterCommandHandler trait
- Usage in main: NONE (AppBuilder doesn't use it)
- Usage in control/roaster_refactored.rs: NOT imported
- Verdict: RE-EXPORTED but NEVER USED as a trait

## pid.rs
- Defined: CoffeeRoasterPid struct
- Referenced in handlers.rs: imported
- Instantiated in handlers.rs: TemperatureCommandHandler creates it
- Actually USED: Yes, CoffeeRoasterPid IS used via handlers
- RE-EVALUATION: pid.rs should NOT be deleted - it's used
- Verdict: KEEP pid.rs

## abstractions_tests.rs
- Defined: MockOutputManager, MockSerialPrinter, MockUartChannel
- Purpose: Test mocks for abstractions
- Usage: Tests for output/manager (which we're deleting)
- Since manager.rs is deleted, these mocks have no purpose
- Verdict: DELETE - orphaned test file

Wait - I need to reconsider pid.rs. Let me check:
- handlers.rs imports: use crate::control::pid::CoffeeRoasterPid;
- handlers.rs uses: pid_controller: CoffeeRoasterPid
- This IS used. DO NOT DELETE pid.rs

Corrected list:
- command_handler.rs - DELETE (unused trait)
- pid.rs - KEEP (actually used)
- abstractions_tests.rs - DELETE (orphaned mocks)

So plan 02 should only delete:
- command_handler.rs
- abstractions_tests.rs
</context>

<tasks>

<task type="auto">
  <name>Delete control/command_handler.rs</name>
  <files>src/control/command_handler.rs</files>
  <action>
    Delete the entire file src/control/command_handler.rs

    This file contains:
    - RoasterCommandHandler trait definition
    - CommandHandler enum variants
    
    The trait is re-exported in mod.rs but never implemented or used.
    RoasterControl in roaster_refactored.rs doesn't use this trait.
  </action>
  <verify>
    ls src/control/command_handler.rs 2>&1 | grep -q "No such file" && echo "File deleted successfully" || echo "ERROR: File still exists"
  </verify>
  <done>
    src/control/command_handler.rs no longer exists
  </done>
</task>

<task type="auto">
  <name>Delete control/abstractions_tests.rs</name>
  <files>src/control/abstractions_tests.rs</files>
  <action>
    Delete the entire file src/control/abstractions_tests.rs

    This file contains:
    - MockOutputManager struct
    - MockSerialPrinter struct
    - MockUartChannel struct
    - Test implementations of OutputManager and SerialOutput traits
    
    These mocks were used for testing output/manager.rs which is being deleted.
    Without the manager module, these mocks have no purpose.
  </action>
  <verify>
    ls src/control/abstractions_tests.rs 2>&1 | grep -q "No such file" && echo "File deleted successfully" || echo "ERROR: File still exists"
  </verify>
  <done>
    src/control/abstractions_tests.rs no longer exists
  </done>
</task>

<task type="auto">
  <name>Clean up control/mod.rs exports</name>
  <files>src/control/mod.rs</files>
  <action>
    Update src/control/mod.rs to remove exports for deleted modules

    Remove these pub use statements:
    - pub use command_handler::*;
    - Remove references to abstractions_tests (not a module, so just the pub use)

    The abstractions_tests.rs file was a #[cfg(test)] module, not a separate module,
    so it doesn't appear in mod.rs - it was included in abstractions.rs via #[path]

    Keep active exports:
    - pub mod pid;
    - pub mod handlers;
    - pub mod roaster_refactored;
    - pub mod abstractions;
    - pub mod traits;
    - pub use roaster_refactored::*;
    - pub use handlers::*;
    - pub use abstractions::*;
    - pub use traits::*;
  </action>
  <verify>
    grep "pub use command_handler" src/control/mod.rs && echo "ERROR: command_handler still referenced" || echo "command_handler export removed"
  </verify>
  <done>
    src/control/mod.rs exports only active modules
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Verify files deleted:
   ```bash
   ls src/control/{command_handler,abstractions_tests}.rs 2>&1 | grep "No such file"
   ```

2. Verify mod.rs exports cleaned:
   ```bash
   grep "pub use\|pub mod" src/control/mod.rs
   ```

3. Verify project still compiles:
   ```bash
   cargo check 2>&1 | head -50
   ```

4. Verify no errors related to deleted modules
</verification>

<success_criteria>
- 2 unused control modules deleted (~230 lines)
- control/mod.rs exports cleaned
- cargo check succeeds with no errors
- No compilation warnings about missing modules
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-removal/04-02-SUMMARY.md`
</output>

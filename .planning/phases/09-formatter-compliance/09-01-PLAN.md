---
phase: 09-formatter-compliance
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/output/artisan.rs
  - tests/command_idempotence.rs
autonomous: true

must_haves:
  truths:
    - "READ responses preserve column order and fixed precision (ET,BT,Power,Fan) across runs"
    - "READ output reflects actual status values without silent clamping"
    - "Boundary values (0 and 100) serialize with deterministic separators and one-decimal precision"
  artifacts:
    - path: "src/output/artisan.rs"
      provides: "READ response formatting without clamping"
    - path: "tests/command_idempotence.rs"
      provides: "Deterministic READ response assertions"
  key_links:
    - from: "src/output/artisan.rs"
      to: "format_read_response"
      via: "explicit format string"
      pattern: "format!\(\"\{:.1\},\{:.1\},\{:.1\},\{:.1\}\""
---

<objective>
Lock deterministic READ response formatting without clamping.

Purpose: Ensure READ outputs remain stable and transparent for Artisan parsing.
Output: Updated formatter logic and tests covering boundary/value fidelity.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-formatter-compliance/09-RESEARCH.md
@.planning/phases/08-command-hardening/08-02-SUMMARY.md
@src/output/artisan.rs
@tests/command_idempotence.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove silent clamping in READ formatter</name>
  <files>src/output/artisan.rs</files>
  <action>
Update `ArtisanFormatter::format_read_response` to stop clamping power/fan values and keep explicit `{:.1}` precision for all four fields. Keep column order ET,BT,Power,Fan and avoid adding CRLF here (UART task remains responsible). Add a focused unit test in the module to assert out-of-range inputs are serialized as-is (no clamp), using stable one-decimal formatting.
  </action>
  <verify>cargo test --test command_idempotence</verify>
  <done>READ formatter returns stable CSV with one-decimal precision and no silent value clamping.</done>
</task>

<task type="auto">
  <name>Task 2: Extend READ response boundary coverage</name>
  <files>tests/command_idempotence.rs</files>
  <action>
Add a deterministic READ response test case that sets ET/BT/Power/Fan to boundary values (0 and 100) and asserts the exact CSV string and column count. Keep the test aligned with the existing deterministic READ assertions.
  </action>
  <verify>cargo test --test command_idempotence</verify>
  <done>Boundary values serialize with fixed precision and separators in READ response tests.</done>
</task>

</tasks>

<verification>
- `cargo test --test command_idempotence` (acknowledge host target may require embedded target/stubs)
- Manual review: `format_read_response` uses explicit precision and no clamp calls
</verification>

<success_criteria>
- READ responses are deterministic (precision/order) without clamping values.
- Boundary values render as expected in tests with stable CSV formatting.
</success_criteria>

<output>
After completion, create `.planning/phases/09-formatter-compliance/09-01-SUMMARY.md`
</output>

---
phase: "27-artisan-connection"
plan: "01"
type: "execute"
wave: 1
depends_on: []
files_modified:
  - "internalDoc/ARTISAN_CONNECTION.md"
  - "README.md"
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User understands the two connection methods (USB CDC and UART0)"
    - "User can identify which port Artisan should connect to"
    - "User can configure Artisan correctly (port, baud rate, settings)"
    - "User can verify successful Artisan connection"
    - "User understands what to expect after connecting"
  artifacts:
    - path: "internalDoc/ARTISAN_CONNECTION.md"
      provides: "Complete Artisan connection guide for roasters"
      min_lines: 150
    - path: "README.md"
      provides: "Updated connection info in main project README"
      min_lines: 245
  key_links:
    - from: "FLASH_GUIDE.md"
      to: "ARTISAN_CONNECTION.md"
      via: "Cross-reference for next step after flashing"
      pattern: "Connect.*Artisan|Artisan.*Connection"
    - from: "ARTISAN_CONNECTION.md"
      to: "PROTOCOL.md"
      via: "Cross-reference for command details"
      pattern: "command.*reference|protocol|commands"
---

<objective>
Create comprehensive Artisan connection documentation for end users (roasters). Enable roasters to successfully connect LibreRoaster to Artisan coffee roasting software.

Purpose: After flashing firmware, roasters need clear instructions to connect and communicate with Artisan.
Output: ARTISAN_CONNECTION.md guide + updated README.md with connection info.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Reference existing documentation
@internalDoc/FLASH_GUIDE.md
@internalDoc/PROTOCOL.md
@README.md
</context>

<tasks>

<task type="auto">
  <name>Analyze existing connection information in codebase</name>
  <files>internalDoc/PROTOCOL.md</files>
  <action>
    Read PROTOCOL.md and extract:
    1. USB CDC connection details (native USB, port appearance)
    2. UART0 connection details (GPIO20/21, 115200 baud)
    3. Channel routing and multiplexer behavior
    4. Initialization sequence if applicable
    5. READ response format (for verification)
    
    Create analysis comment at top of ARTISAN_CONNECTION.md documenting key connection facts.
  </action>
  <verify>Analysis exists at top of ARTISAN_CONNECTION.md with connection facts</verify>
  <done>Connection information analyzed and documented</done>
</task>

<task type="auto">
  <name>Create ARTISAN_CONNECTION.md guide</name>
  <files>internalDoc/ARTISAN_CONNECTION.md</files>
  <action>
    Create a comprehensive ARTISAN_CONNECTION.md guide with this structure:

    1. **Title**: "LibreRoaster Artisan Connection Guide"
    
    2. **Overview Section** (NEW):
       - What this guide covers (connecting to Artisan)
       - What you'll achieve (stable connection for roasting)
       - Time estimate (5-10 minutes)
    
    3. **Two Ways to Connect** (CLEAR COMPARISON):
       - USB CDC (native USB) — pros: simple, no adapter; cons: depends on USB driver
       - UART0 (GPIO20/21) — pros: reliable, standard serial; cons: needs USB-UART adapter
    
    4. **USB CDC Connection** (DETAILED STEPS):
       - How to identify the port (ttyACM on Linux, COM on Windows)
       - Driver requirements if needed
       - Baud rate: 115200
       - Settings: 8N1, no flow control
    
    5. **UART0 Connection** (DETAILED STEPS):
       - Wiring diagram (GPIO20 TX, GPIO21 RX, GND)
       - USB-to-UART adapter requirements
       - Common adapters (CH340, CP2102, FTDI)
       - Baud rate: 115200
    
    6. **Artisan Configuration** (STEP-BY-STEP):
       - Device Configuration dialog walkthrough
       - Port selection (with screenshots placeholders)
       - Baud rate: 115200
       - Arduino/RPi mode: enable
       - Extra: "机电" (if applicable)
    
    7. **Verifying Connection** (WITH EXAMPLES):
       - What Artisan should show after connecting
       - How to verify READ command works
       - Expected READ response format
       - Visual indicators in Artisan
    
    8. **Troubleshooting** (COMMON ISSUES):
       - Port not appearing
       - Artisan can't connect
       - Communication works but data looks wrong
       - Dropped connections
       - Channel multiplexer issues
    
    9. **Next Steps** (LINK TO COMMANDS):
       - Brief preview of what commands do
       - Link to Command Reference (PROTOCOL.md)
    
    Keep language simple. Add image placeholders for screenshots.
  </action>
  <verify>ARTISAN_CONNECTION.md exists with all 9 sections</verify>
  <done>Complete Artisan Connection Guide created</done>
</task>

<task type="auto">
  <name>Update README.md with connection information</name>
  <files>README.md</files>
  <action>
    Update README.md to include or improve the Artisan Connection section (around line 85-92):

    1. Expand "Artisan Connection" section with:
       - Clear explanation of USB CDC vs UART0
       - Brief connection steps
       - Link to detailed guide (ARTISAN_CONNECTION.md)

    2. Update Quick Start section (line 38-62) to reference:
       - FLASH_GUIDE.md for flashing
       - ARTISAN_CONNECTION.md for connection

    Keep the existing structure but enhance clarity for new users.
  </action>
  <verify>README.md has updated Artisan Connection section with link to ARTISAN_CONNECTION.md</verify>
  <done>README.md updated with connection information</done>
</task>

</tasks>

<verification>
1. ARTISAN_CONNECTION.md has all sections: Overview, Two Ways to Connect, USB CDC, UART0, Artisan Configuration, Verifying Connection, Troubleshooting, Next Steps
2. USB CDC and UART0 connection methods are clearly explained
3. README.md updated with connection info and links
4. Connection can be verified by user following the guide
5. Troubleshooting covers common issues
</verification>

<success_criteria>
- ARTISAN_CONNECTION.md contains 150+ lines with complete connection guide
- README.md has updated connection section with cross-reference
- Language accessible to non-technical users
- Both USB CDC and UART0 options covered
- Artisan configuration steps are clear
- Troubleshooting section addresses common connection issues
</success_criteria>

<output>
After completion, create `.planning/phases/27-artisan-connection/27-01-SUMMARY.md`
</output>

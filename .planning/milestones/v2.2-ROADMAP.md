# Milestone v2.2: Comandos de Entrada

**Status:** ✅ SHIPPED 2026-02-07
**Phases:** 35-37
**Total Plans:** 3

## Overview

Implement Artisan-to-ESP32 command parsing for heater/fan control and temperature telemetry. This milestone adds OT2 fan control, READ telemetry response, and UNITS temperature scale parsing to complete the Artisan protocol implementation.

## Phases

### Phase 35: OT2 Command

**Goal:** Fan speed control via OT2 command (0-100 range)
**Depends on:** None
**Plans:** 1 plan

Plans:

- [x] 35-01: OT2 parser + fan control + tests

**Details:**
Implements OT2 command parsing with decimal rounding, silent clamping to 0-100, and safety feature that stops heater when out-of-range values are received. Parser handles OT2,{n} format and returns SetFanSpeed command.

### Phase 36: READ Telemetry

**Goal:** ArtisanFormatter response wired to READ command with disabled channel documentation
**Depends on:** Phase 35 (fan state needed for telemetry)
**Plans:** 1 plan

Plans:

- [x] 36-01: ArtisanFormatter wiring + tests

**Details:**
Wires format_read_response_full() to READ command. CSV format: ET,BT,-1,-1,-1,FAN,HEATER with one decimal place. Adds comment documenting BT2/ET2 placeholders for future thermocouple support. Error handling stops heater and panics on malformed output.

### Phase 37: UNITS Parsing

**Goal:** Temperature scale command parsed without conversion applied
**Depends on:** Phase 36 (READ can verify scale preference stored)
**Plans:** 1 plan

Plans:

- [x] 37-01: Temperature scale enum + storage + parser

**Details:**
Adds TemperatureScale enum (Celsius, Fahrenheit) and TemperatureSettings struct for storage. Parser accepts UNITS;C/F during initialization, stores preference with default Celsius. No temperature conversion applied—only parsing and storage.

---

## Milestone Summary

**Key Decisions:**

- OT2 decimal rounding: Round to nearest integer (50.5 → 51)
- OT2 safety: Stop heater on out-of-range values
- READ format: One decimal place for FAN/HEATER (75.0)
- UNITS scope: Parse only, no conversion (temperatures stay Celsius internally)
- Error handling: Panic on malformed READ response after stopping heater

**Issues Resolved:**

- OT2 command now properly controls fan speed with safety measures
- READ command returns proper CSV telemetry per Artisan spec
- BT2/ET2 channels documented as disabled (-1 placeholders)
- UNITS command stores temperature scale preference

**Issues Deferred:**

- Temperature C↔F conversion (out of scope per requirements)
- Fan rate limiting (25 pts/sec) — not required for V1
- IO3 alias for OT2 — legacy compatibility not critical
- READ format validation tests — deferred to future

**Technical Debt Incurred:**

None. All implementation follows existing patterns and maintains code quality standards.

---

_For current project status, see .planning/ROADMAP.md_

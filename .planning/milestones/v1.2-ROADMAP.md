# Milestone v1.2: Artisan integration polish

**Status:** ✅ SHIPPED 2026-02-04
**Phases:** 8-10
**Total Plans:** 5

## Overview

This milestone hardened the existing Artisan command handlers, locked formatter compliance, and verified end-to-end behavior over a mock UART loop for core protocol commands.

## Phases

### Phase 8: Command Hardening

**Goal**: Core commands enforce bounds, idempotence, and explicit errors with no unintended side effects.
**Depends on**: None
**Plans**: 2 plans

Plans:

- [x] 08-01: explicit command errors and bounds enforcement
- [x] 08-02: start/stop idempotence and deterministic READ responses

**Details:**
1. READ responses include the required telemetry fields with deterministic columns and precision (no missing/extra fields).
2. START is idempotent: repeated START keeps streaming on exactly once without duplicating sessions.
3. STOP is idempotent: repeated STOP halts streaming, leaves outputs safe, and resets state consistently.
4. OT1 and IO3 accept only 0–100%; out-of-range or malformed payloads return explicit error/NAK and leave outputs unchanged.
5. Unknown or unsupported commands return explicit error/NAK and do not alter state.

### Phase 9: Formatter Compliance

**Goal**: Responses use deterministic formatting and consistent error schema across normal and invalid inputs.
**Depends on**: Phase 8
**Plans**: 2 plans

Plans:

- [x] 09-01: lock deterministic READ formatting without clamping
- [x] 09-02: standardize ERR schema across parse and handler errors

**Details:**
1. READ and other responses emit stable numeric precision, separators, column order, and CRLF termination across runs.
2. Error responses follow a consistent code/message schema and never clamp or modify values silently.
3. Invalid inputs produce stable, parseable error output regardless of value or field boundaries.

### Phase 10: Mock UART Integration

**Goal**: End-to-end mock UART flows verify command responses, state transitions, and safe shutdown sequencing.
**Depends on**: Phase 9
**Plans**: 1 plan

Plans:

- [x] 10-01: mock UART integration tests for command flows and errors

**Details:**
1. Success-path UART tests cover READ, START, STOP, OT1, and IO3, asserting responses and state transitions match expectations.
2. Error-path UART tests cover unknown commands and out-of-range/malformed setpoints, asserting explicit errors and no side effects.
3. Start→command→stop sequences toggle streaming correctly and leave outputs in a safe state after STOP.

---

## Milestone Summary

**Decimal Phases:** None.

**Key Decisions:**
- Standardized `ERR <code> <message>` schema for parse and handler errors.
- Removed READ clamping; formatter emits exact values with fixed precision and ET,BT,Power,Fan ordering.
- Gated embedded binary behind `embedded` feature and added host stubs to enable host-target integration tests.

**Issues Resolved:**
- Unified parse and handler error outputs for stable protocol parsing.
- Added host-friendly mock UART integration tests for success and error flows.
- Enabled host-target test runs without embedded linker failures.

**Issues Deferred:**
- Hardware validation on ESP32-C3 (requires physical device).
- Extended Artisan/Artisan+ command coverage beyond core commands.
- Timing/jitter tolerance and formatter snapshot suites.

**Technical Debt Incurred:**
- None recorded.

---

_For current project status, see .planning/ROADMAP.md_
